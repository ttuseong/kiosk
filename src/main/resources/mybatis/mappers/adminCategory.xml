<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminCategory">
	<!-- 카테고리 리스트, 페이징, 서치 -->
	<select id="selectAdminCateList" parameterType="map" resultType="com.javaex.vo.CategoryVo">
		<![CDATA[
		SELECT
    			rn,
    			categoryNo,
   				categoryName,
   				publicYN,
   				categoryImg
		FROM
				(SELECT
	            		ROWNUM rn,
	            		categoryNo,
	            		categoryName,
	            		publicYN,
	            		categoryImg
	        	 FROM
						 (SELECT  
				        		categoryNo,
				        		categoryName,
				        		publicYN,
				        		categoryImg
						 FROM 
				        		category
						 WHERE 
				        		storeno=1
		]]>		
				        <if test="searchTerm neq null">
						 AND
			         			categoryName like'%'||#{searchTerm}||'%'
			      		</if>
		<![CDATA[		
						 ORDER BY 
						 		categoryNo desc))
		WHERE
    			rn >= #{startPoint}
		AND
    			rn <= #{endPoint}		 		
		]]>
	</select>
	
	<!-- 페이지 categoryNo 값 가져오기 -->
	<select id="selectAdminCateCount" parameterType="map" resultType="int">
		<![CDATA[
			SELECT
					count(categoryNo)
			FROM
					category
			WHERE
					storeno=#{storeNo}
		]]>		
					 <if test="searchTerm neq null">
					 AND
			         	 categoryName like'%'||#{searchTerm}||'%'
			      	</if>
		
	</select>
	
	<!-- 카테고리 추가 -->
	<select id="selectCateUpdate" parameterType="String" resultType="com.javaex.vo.CategoryVo">
		<![CDATA[
			 SELECT 
			 		categoryname,
	        		storeno
			 FROM 
			 		category
			 WHERE 
			 		categoryname = #{categoryName}
			 AND
			 		storeno=1
		]]>
	</select>
	
	
	<!-- selectKey 기능추가-->
	<insert id="insertCateAdd" parameterType="com.javaex.vo.CategoryVo">
		<selectKey keyProperty="categoryNo" resultType="int" order="BEFORE">
			select CATEGORY_SEQ.nextval FROM dual
		</selectKey>
			<![CDATA[
				INSERT INTO
						category
				VALUES( #{categoryNo},
						#{storeNo},
						#{categoryName},
						#{publicYN},
						'icon1.png')
			]]>
	</insert>
	
	
	
	<select id="selectCateOneByCategoryNo" parameterType="int" resultType="com.javaex.vo.CategoryVo">
		<![CDATA[
			SELECT  
	        		categoryNo,
	        		categoryName,
	        		publicYN
			 FROM 
	        		category
			 WHERE 
	        		categoryNo=#{categoryNo}
		]]>
	</select>
	
	<!-- 첫번째  ajax alert창 띄우기 -->
	<select id="selectOneMenuCount" parameterType="int" resultType="int">
		<![CDATA[
			SELECT 
				 count(*) cnt
			FROM 
				 menu
			WHERE 
				 categoryNo=#{categoryNo}
		]]>
	</select>
	
	
 	<delete id="deleteCate" parameterType="int">
		<![CDATA[
			delete from category
			where categoryNo = #{categoryNo}
		]]>
	</delete>
	
	<!-- 카테고리 수정 -->
	<select id="titleUpdate" parameterType="com.javaex.vo.CategoryVo">
		<![CDATA[
		update category
		set categoryName = #{categoryName},
    		publicYn = #{publicYN}
		where 
    		categoryNo = #{categoryNo}
		]]>
	</select>
</mapper>